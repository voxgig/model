#!/usr/bin/env node

const Fs = require('fs')
const Path = require('path')

let { Model } = require('../dist/model.js')

let path = process.argv[2]
let once = '--once' === process.argv[3]

if(null == path || '' == path) {
  console.error('ERROR: First argument should be a jsonic model file path.')
  process.exit(1)
}

let fstats = Fs.statSync(path)
let base = path

if (fstats.isFile()) {
  let basedesc = Path.parse(base)
  base = basedesc.dir
}

path = Path.resolve(path)
console.log('PATH', path)

let src = Fs.readFileSync(path).toString()

let model = new Model({src,path,base})


async function run() {
  if(once) {
    let br = await model.run()
    console.log('OK:'+br.ok, once)
  }
  else {
    console.log('WATCHING...')
    model.start()
  }
}


run()
